# 설비별 매뉴얼 챗봇 구현 계획

## 📋 현재 상황 분석

### 보유 자산
- ✅ **RAG 빌드 시스템**: `chatbot/codes/rag build all.ts`
- ✅ **벡터 인덱싱**: `chatbot/codes/index_vectra.ts`  
- ✅ **매뉴얼 파일들**: `chatbot/manuals/` (5개 PDF 파일)
- ✅ **메타데이터 관리**: `chatbot/codes/manifest.docs.json`
- ✅ **기존 벡터DB**: Vectra LocalIndex 시스템

### 매뉴얼 파일 목록
1. `170kV 50kA Spring GIS_취급설명서.pdf` (변전설비)
2. `수차발전기 대점검 순서도(배수).pdf` (수력 공통)
3. `1호기 매뉴얼(en).pdf` (수력 1호기)
4. `2호기 매뉴얼.pdf` (수력 2호기)  
5. `2호기 조속기.pdf` (수력 2호기 - 디지털조속기)

## 🛠️ 구현 단계

### 1단계: 매뉴얼 데이터 전처리 및 임베딩
```bash
# chatbot/codes/ 디렉토리에서 실행
ts-node "rag build all.ts" \
  --pdf "../manuals/170kV 50kA Spring GIS_취급설명서.pdf" \
  --pdf "../manuals/수차발전기 대점검 순서도(배수).pdf" \
  --pdf "../manuals/1호기 매뉴얼(en).pdf" \
  --pdf "../manuals/2호기 매뉴얼.pdf" \
  --pdf "../manuals/2호기 조속기.pdf" \
  --manifest "./manifest.docs.json" \
  --out ./manual_chunks \
  --openai --merge --bm25
```

### 2단계: Vectra 벡터DB 인덱싱
```bash
ts-node index_vectra.ts \
  --file ./manual_chunks/merged/embeddings.ndjson \
  --store ./vectra-manuals \
  --index equipment-manuals \
  --latest-per-doc
```

### 3단계: 챗봇 API 엔드포인트 구현
- 설비별 질의 처리
- 컨텍스트 기반 답변 생성
- 매뉴얼 섹션 참조 제공

### 4단계: 프론트엔드 챗봇 UI 구현
- 설비 선택 인터페이스
- 실시간 채팅 UI
- 매뉴얼 참조 링크 표시

## 🔧 기술적 장점

### 1. 전문 도메인 최적화
- **설비별 분류**: 변전설비(GIS), 수력발전(1호기/2호기), 조속기
- **전문 용어 매핑**: 170여개 전문 용어 동의어 사전
- **다국어 지원**: 한국어/영어 매뉴얼 혼합 처리

### 2. 정밀한 청킹 전략
- **구조화된 분할**: 장/절 번호, 로마숫자, 순서도 단계별
- **컨텍스트 보존**: 950자 청킹 + 80자 오버랩
- **메타데이터 풍부**: 페이지, 섹션, 작업유형, 위험요소 자동 태깅

### 3. 하이브리드 검색
- **벡터 검색**: 의미 기반 유사도
- **키워드 검색**: BM25 스파스 인덱스
- **메타데이터 필터링**: 설비별, 작업유형별 필터

## 🎯 예상 사용 시나리오

### 시나리오 1: GIS 설비 점검
**사용자**: "170kV GIS 차단기 점검 절차가 어떻게 되나요?"
**시스템**: GIS 매뉴얼에서 차단기 관련 절차 섹션 검색 → 단계별 절차 + 안전수칙 제공

### 시나리오 2: 수력발전 운전
**사용자**: "2호기 조속기 PID 게인 조정 방법은?"
**시스템**: 2호기 조속기 매뉴얼에서 PID 관련 섹션 검색 → Kp, Ki, Kd 설정 절차 제공

### 시나리오 3: 배수 작업
**사용자**: "배수펌프 운전 시 안전수칙이 뭔가요?"
**시스템**: 순서도 매뉴얼에서 배수 관련 절차 + 위험요소 + 안전수칙 종합 제공

## 📊 구현 우선순위

### HIGH (즉시 구현)
1. ✅ 매뉴얼 전처리 및 임베딩 (기존 코드 활용)
2. ✅ 벡터DB 구축 (기존 Vectra 시스템 확장)
3. 🔄 챗봇 API 엔드포인트 구현

### MEDIUM (2차 구현)  
4. 🔄 프론트엔드 챗봇 UI
5. 🔄 설비별 필터링 UI
6. 🔄 매뉴얼 참조 링크 시스템

### LOW (향후 확장)
7. ⏳ 음성 입력/출력
8. ⏳ 이미지/도표 OCR 처리
9. ⏳ 실시간 매뉴얼 업데이트

## 🚨 주의사항

### 데이터 품질
- PDF 텍스트 추출 품질 확인 필요
- 도표/이미지 정보 누락 가능성
- 한영 혼합 텍스트 처리 검증

### 성능 최적화
- 벡터 검색 응답 시간 (<2초 목표)
- 캐싱 전략 구현
- 배치 크기 조정 (현재 256)

### 보안 고려사항
- 매뉴얼 내 민감 정보 마스킹
- 사용자 질의 로깅 정책
- API 접근 권한 관리

## 💡 결론

**실행 가능성: 매우 높음 (95%)**

기존 RAG 인프라와 매뉴얼 파일들을 활용하여 **1-2주 내** 프로토타입 구현이 가능합니다. 특히 전문 도메인에 최적화된 용어 사전과 구조화된 청킹 시스템이 이미 구축되어 있어 높은 품질의 답변을 기대할 수 있습니다.